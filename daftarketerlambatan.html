<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Daftar Keterlambatan</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
/* --- MODERN & MINIMALIST STYLING with CYAN HEADER --- */
body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f4f7f6;
    color: #333;
    /* Padding diubah: top 10px, sisanya 20px */
    padding: 10px 20px 20px 20px; 
}
h2 {
    text-align: center;
    color: #1f3a6a;
    margin-bottom: 20px;
    font-weight: 600;
    height: 1.5em;
    /* Mengurangi margin-top agar lebih dekat ke atas jika ada judul */
    margin-top: 0; 
}
table {
    width: 100%;
    border-collapse: collapse;
    /* Margin atas dihilangkan sepenuhnya (0px) untuk menempel ke atas */
    margin-top: 0; 
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    border-radius: 10px;
    overflow: hidden;
    background-color: #fff;
}
th, td {
    border: none;
    padding: 12px 15px;
}
th {
    /* --- CYAN COLOR FOR HEADER (TH) --- */
    background: #00bcd4; /* Bright Cyan */
    color: #fff;
    font-weight: 600;
    border-bottom: 2px solid #0097a7;
    text-align: center;
}
td {
    border-bottom: 1px solid #eee;
}
tr:nth-child(even) {
    background: #f9f9f9;
}
tr:hover {
    background-color: #e6f7ff;
}

/* Specific Column Alignment for Better Readability */
td:nth-child(-n+4), th:nth-child(-n+4) {
    text-align: left;
}
td:nth-child(5), th:nth-child(5) {
    text-align: center; /* Harus Kembali (Date) */
}
td:nth-child(6), th:nth-child(6), td:nth-child(7), th:nth-child(7) {
    text-align: right; /* Keterlambatan, Denda (Numbers) */
}
</style>
</head>
<body>

<h2></h2>
<table>
  <thead>
    <tr>
      <th>Nama</th>
      <th>Blok</th>
      <th>Judul Buku</th>
      <th>Kode Inventaris</th>
      <th>Harus Kembali</th>
      <th>Keterlambatan (hari)</th>
      <th>Denda</th>
    </tr>
  </thead>
  <tbody id="lateBody"></tbody>
</table>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyByw2om-sKHqgCWBDJcE7FEtONoUoJbn9M",
  authDomain: "traying-29bf4.firebaseapp.com",
  databaseURL: "https://traying-29bf4-default-rtdb.firebaseio.com",
  projectId: "traying-29bf4",
  storageBucket: "traying-29bf4.appspot.com",
  messagingSenderId: "42080663883",
  appId: "1:42080663883:web:58f28d5d1164204457d030"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function formatRupiah(num){ return "Rp " + num.toLocaleString("id-ID"); }

function updateKeterlambatan(){
  const tbody = document.getElementById('lateBody');
  db.ref('peminjaman').on('value', snap => {
    tbody.innerHTML = '';
    const hariIni = new Date();
    hariIni.setHours(0,0,0,0);

    snap.forEach(child => {
      const data = child.val();
      if(!data.tanggalKembali) return; // ambil dari field yang ada di Firebase
      const tglKembali = new Date(data.tanggalKembali);
      tglKembali.setHours(0,0,0,0);

      if(hariIni > tglKembali){
        const diffDays = Math.floor((hariIni - tglKembali)/(1000*60*60*24));
        const denda = diffDays * 1000;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${data.nama || '-'}</td>
          <td>${data.blok || '-'}</td>
          <td>${data.judul || '-'}</td>
          <td>${data.kode || '-'}</td>
          <td>${data.tanggalKembali || '-'}</td>
          <td>${diffDays}</td>
          <td>${formatRupiah(denda)}</td>
        `;
        tbody.appendChild(tr);
      }
    });
  });
}

updateKeterlambatan();
</script>

</body>
</html>
