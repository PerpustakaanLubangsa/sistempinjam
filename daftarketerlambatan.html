<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Daftar Keterlambatan</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
body { margin:0; font-family:sans-serif; background:#e0f7fa; color:#006064; padding:20px; }
h2 { text-align:center; color:#004d40; }
table { width:100%; border-collapse: collapse; margin-top:20px; }
th, td { border:1px solid #00bcd4; padding:10px; text-align:center; }
th { background:#00bcd4; color:#fff; }
tr:nth-child(even) { background:#b2ebf2; }
</style>
</head>
<body>

<h2>ðŸ“• Daftar Keterlambatan</h2>
<table>
  <thead>
    <tr>
      <th>Nama</th>
      <th>Blok</th>
      <th>Judul Buku</th>
      <th>Kode Inventaris</th>
      <th>Harus Kembali</th>
      <th>Keterlambatan (hari)</th>
      <th>Denda</th>
    </tr>
  </thead>
  <tbody id="lateBody"></tbody>
</table>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyByw2om-sKHqgCWBDJcE7FEtONoUoJbn9M",
  authDomain: "traying-29bf4.firebaseapp.com",
  databaseURL: "https://traying-29bf4-default-rtdb.firebaseio.com",
  projectId: "traying-29bf4",
  storageBucket: "traying-29bf4.appspot.com",
  messagingSenderId: "42080663883",
  appId: "1:42080663883:web:58f28d5d1164204457d030"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function formatRupiah(num){ return "Rp " + num.toLocaleString("id-ID"); }

function updateKeterlambatan(){
  const tbody = document.getElementById('lateBody');
  db.ref('peminjaman').on('value', snap => {
    tbody.innerHTML = '';
    const hariIni = new Date();
    hariIni.setHours(0,0,0,0);

    snap.forEach(child => {
      const data = child.val();
      if(!data.tanggalKembali) return; // ambil dari field yang ada di Firebase
      const tglKembali = new Date(data.tanggalKembali);
      tglKembali.setHours(0,0,0,0);

      if(hariIni > tglKembali){
        const diffDays = Math.floor((hariIni - tglKembali)/(1000*60*60*24));
        const denda = diffDays * 1000;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${data.nama || '-'}</td>
          <td>${data.blok || '-'}</td>
          <td>${data.judul || '-'}</td>
          <td>${data.kode || '-'}</td>
          <td>${data.tanggalKembali || '-'}</td>
          <td>${diffDays}</td>
          <td>${formatRupiah(denda)}</td>
        `;
        tbody.appendChild(tr);
      }
    });
  });
}

updateKeterlambatan();
</script>

</body>
</html>
