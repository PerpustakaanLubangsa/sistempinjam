<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kembalikan Buku</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body {margin:0;font-family:sans-serif;background:#e0f7fa;display:flex;justify-content:center;align-items:center;height:100vh;color:#00bcd4;}
.container {background:#fff;padding:40px 30px 30px 30px;border-radius:15px;box-shadow:0 8px 20px rgba(0,188,212,0.2);text-align:center;width:350px;animation:fadeIn 1s ease;}
h2 {margin-bottom:20px;font-weight:700;color:#00bcd4;animation:slideDown 0.8s ease;}
.input-card {margin:15px 0;}
.input-card input {width:90%;padding:10px;border-radius:10px;border:2px solid #00bcd4;outline:none;font-size:1em;transition:0.3s;display:block;margin:0 auto;}
.input-card input:focus {border-color:#00acc1;box-shadow:0 0 8px #00acc1;}
button {width:50%;padding:10px;margin-top:20px;border-radius:10px;border:none;background:#00bcd4;color:#fff;font-weight:bold;cursor:pointer;transition:0.3s;display:block;margin:auto;}
button:hover {background:#00acc1;transform:scale(1.05);}
#infoKembali {margin-top:20px;padding:15px;background:#e0f7fa;border-radius:10px;border:1px solid #00bcd4;font-weight:600;text-align:left;}
#resetBtn {margin-top:10px;display:none;width:60%;}
@keyframes fadeIn {from {opacity:0;} to {opacity:1;}}
@keyframes slideDown {from {transform:translateY(-20px);opacity:0;} to {transform:translateY(0);opacity:1;}}
</style>
</head>
<body>

<div class="container">
    <h2>Kembalikan Buku</h2>
    <div class="input-card"><input id="inventaris" type="number" placeholder="Inventaris"></div>
    <button onclick="kembalikanBuku()">Kembalikan</button>
    <button id="resetBtn" onclick="resetForm()">Transaksi Baru</button>
    <div id="infoKembali"></div>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDguC7UH1JUzBQu1JZX8qPJGVeb6Pc7t98",
    authDomain: "pustakawan-26664.firebaseapp.com",
    databaseURL: "https://pustakawan-26664-default-rtdb.firebaseio.com",
    projectId: "pustakawan-26664",
    storageBucket: "pustakawan-26664.firebasestorage.app",
    messagingSenderId: "284579513964",
    appId: "1:284579513964:web:b45f73ac287e1f49eeba49"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function parseTanggal(tglStr) {
    const bulan = {Januari:0,Februari:1,Maret:2,April:3,Mei:4,Juni:5,Juli:6,Agustus:7,September:8,Oktober:9,November:10,Desember:11};
    const parts = tglStr.split(' ');
    return new Date(parts[2], bulan[parts[1]], parts[0]);
}

function kembalikanBuku() {
    const inventaris = Number(document.getElementById('inventaris').value);
    if(!inventaris){ alert("Masukkan nomor inventaris!"); return; }

    db.ref('pinjam').orderByChild('inventaris').equalTo(inventaris).once('value', snapshot=>{
        if(snapshot.exists()){
            snapshot.forEach(childSnap=>{
                const data = childSnap.val();
                const tanggalKembali = parseTanggal(data.tanggal_kembali);
                const hariIni = new Date();
                hariIni.setHours(0,0,0,0);
                tanggalKembali.setHours(0,0,0,0);
                let info = `<b>Buku berhasil dikembalikan</b><br><br>`;
                info += `<b>Nama:</b> ${data.nama}<br>`;
                info += `<b>Blok:</b> ${data.blok}<br>`;
                info += `<b>NIS:</b> ${data.nis}<br>`;
                info += `<b>Judul Buku:</b> ${data.judul}<br>`;
                info += `<b>Inventaris:</b> ${data.inventaris}<br>`;
                info += `<b>Tanggal Pinjam:</b> ${data.tanggal}<br>`;
                info += `<b>Harus Dikembalikan:</b> ${data.tanggal_kembali}<br>`;

                if(hariIni > tanggalKembali){
                    const diffTime = hariIni - tanggalKembali;
                    const diffDays = Math.floor(diffTime / (1000*60*60*24));
                    const denda = diffDays * 1000;
                    info += `<b>Keterlambatan:</b> ${diffDays} hari<br>`;
                    info += `<b>Denda:</b> Rp${denda}<br>`;
                }

                document.getElementById('infoKembali').innerHTML = info;
                document.getElementById('resetBtn').style.display = 'block'; // tampilkan tombol transaksi baru
                childSnap.ref.remove();
            });
        } else {
            alert("Data inventaris tidak ditemukan atau sudah dikembalikan!");
        }
    });
}

function resetForm(){
    document.getElementById('inventaris').value = '';
    document.getElementById('infoKembali').innerHTML = '';
    document.getElementById('resetBtn').style.display = 'none';
}
</script>

</body>
</html>
